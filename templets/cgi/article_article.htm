<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="renderer" content="webkit">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>素材网|测试文章２</title>
<meta name="keywords" content="">
<link href="{dede:global.cfg_templets_skin/}/css/style.css" type="text/css" rel="stylesheet" />
<script src="{dede:global.cfg_templets_skin/}/js/jquery-1.11.3.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/templets/cgi/layui/layui.js"></script>
<script language="javascript" type="text/javascript" src="{dede:global.cfg_cmsurl/}/include/dedeajax2.js"></script>
<style type="text/css">
/*.zan p{
    background: red; opacity:.8;filter:alpha(opacity=80);
}
.zan p a{
  padding-left: 30px;
  height: 24px;
  background:url(/images/heart.png) no-repeat 4px -1px;
  color: #fff;
  font-weight: bold; 
  font-size:14px
}
.zan p a:hover{
  background-position:4px -25px;
  text-decoration:none
}*/
</style>
</head>

<body>
<div id="container">
<div class="header clearfix ctnt">
    <div class="logo"><img src="{dede:global.cfg_templets_skin/}/images/logo.png" /></div>
    <ul class="layui-nav">
  <li class="layui-nav-item layui-this"> <a href="/">首页</a> </li>
  {dede:channelartlist typeid='top' row='10' currentstyle="<li class='nactive'><a href='~typelink~' ~rel~><span>~typename~</span></a></li>"}
  <li class="layui-nav-item">
    <!-- <a href="{dede:field name='typeurl'/}" >{dede:field name='typename' /}</a> -->
    <a href="javascript:;" >{dede:field name='typename' /}</a>
    <dl class="layui-nav-child snav">
    <dd>
    {dede:sql sql='select * from dede_arctype where reid =~id~ '}
        <a href="javascript:;" class="btit">[field:typename/]</a>
        <div class="snavfl clearfix">
        [field:id runphp='yes']
                global $dsql;
                $id=@me;
                $sql='Select * from dede_arctype where reid='.$id.' ORDER BY id limit 0,20';
                $dsql->SetQuery($sql);
                $dsql->Execute();
                while($row = $dsql->GetArray()){
                    $url = str_replace("{cmspath}","",$row['typedir']);
                    $str .='<a href="/plus/list.php?tid='.$row[id].'">'.$row['typename'].'</a>';
                    @me = $str;
                }                      
                if(@me == $id){
                  @me ='';
                }
         [/field:id]
         </div>
      {/dede:sql}
    </dd>
    </dl>
  </li>
  {/dede:channelartlist}
  {dede:php}
  require_once(DEDEMEMBER."/config.php");
  if(checkLogin()){
    echo '
    <li class="layui-nav-item layui-nav-item1 usera" lay-unselect=""> <a href="javascript:;"><img src="/templets/cgi/images/noavatar.gif" class="layui-nav-img">'.$uid.'</a><dl class="layui-nav-child"><dd><a href="/">个人中心</a></dd><dd><a id="login_out" href="/member/index_do.php?fmdo=login&dopost=exit">退出</a></dd></dl></li>';
  }
  {/dede:php}
</ul>

{dede:php}
  require_once(DEDEMEMBER."/config.php");
  if(!checkLogin()){
    echo '
    <div class="login"><a href="#" onclick="logintc()">登录</a>|<a href="#" onclick="design()">注册</a></div>';
  }
{/dede:php}

    
</div>
  <div class="detail">
    <div class="dmain">
      <div class="dmain-t">
        <h1>{dede:field.title/}</h1>
        <div class="intro">
          <ul>
            <li> 分类：合作 - <a href="#" target="_blank">资助&amp;合作</a>- <a href="#" target="_blank">推广教程</a> </li>
            <li> 标签： <a href="#" target="_blank">超写实</a> <a href="#" target="_blank">模型</a> <a href="#" target="_blank">预售</a> <a href="#" target="_blank">场景</a> </li>
          </ul>
        </div>
        <div class="conn"> <span class="view"> <i class="fa fa-eye" aria-hidden="true"></i>
    <script src="{dede:field name='phpurl'/}/count.php?view=yes&aid={dede:field name='id'/}&mid={dede:field name='mid'/}&cid={dede:field name='channel'/}" type='text/javascript' language="javascript"></script>
 </span><span class="talk"> <i class="fa fa-commenting-o" aria-hidden="true"></i>{dede:field.id runphp=’yes’} @me = $id = @me; 
$dsql = new dedesql(); 
$row = $dsql->GetOne("Select count(id) as c from dede_feedback where aid='$id'"); 
@me = $row['c'] ? $row['c'] : 0; 
{/dede:field.id} </span><span class="up" rel="{dede:field.id/}"> <i class="fa fa-thumbs-o-up" aria-hidden="true"></i> {dede:field.id function="zan(@me)"/} </span> </div>
      </div>
      <div class="dmain-m">
        <p>{dede:field.body/}</p>
      <div class="ding">
        <div class="up" rel="{dede:field.id/}"> <a href="javascript:;">顶</a>
          <p class="num"> <span>{dede:field.id function="zan(@me)"/}</span> </p>
        </div>
      </div>

<!-- <div class="zan"><p><a href="#"
title="赞一个 "class="img_on" rel="{dede:field.id/}">{dede:field.id function="zan(@me)"/}</a></p></div> -->

      <div class="download"> <img src="{dede:global.cfg_templets_skin/}/images/downico1_1.gif" />
        {dede:php}
          require_once(DEDEMEMBER."/config.php");
          if(!checkLogin()){
            echo '
            <p>注册登录后可下载，点击<a href="#" onclick="logintc()">登录</a>，点击<a href="#"  onclick="design()">注册</a></p>';
          } else {
            echo '<p>已登录，看下这里要显示哪些东西？</p>';
          }
        {/dede:php}
        
      </div>
    </div>

  </div>


    <!--登录弹窗-->
  <div class="logina"  id="logintc" style="display:none;">
 <form id="login_form" class="layui-form" method="post" action="/member/login.php">
    <input type="hidden" name="ecmsfrom" value="9">
    <input name="tobind" type="hidden" id="tobind" value="0">
    <input type="hidden" name="enews" value="login">
    <input type="hidden" name="lifetime" value="3600">
  <div class="layui-form-item">
    <label class="layui-form-label">用户名</label>
    <div class="layui-input-block">
      <input type="text" name="username" id="login_name" lay-verify="title" autocomplete>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">密码</label>
    <div class="layui-input-block">
      <input type="password" name="password" id="login_password" lay-verify="required" autocomplete>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">&nbsp;</label>
    <div class="layui-input-block">
      <p><a href="/e/member/GetPassword/">忘记密码？</a></p>
    </div>
  </div>

   <div class="layui-form-item">
    <label class="layui-form-label">验证码</label>
    <div class="layui-input-block">
          <input id="vdcode" class="text login_from3" type="text" style="width: 50px; text-transform: uppercase;" name="vdcode"/>
          <img id="vdimgck" align="absmiddle" onclick="this.src=this.src+'?'" style="cursor: pointer;" alt="看不清？点击更换" src="/include/vdimgck.php"/>
           看不清？ <a href="#" onclick="changeAuthCode();">点击更换</a>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-input-block">
      <button id="login_button" class="layui-btn layui-btn1" lay-submit="" lay-filter="demo1">立即登录
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>
</form>
  </div>

  <!--注册弹窗-->
  <div class="logina"  id="design" style="display:none;">
     <form class="layui-form" method="post" name="userinfoform" action="/member/index_do.php?fmdo=user&dopost=regnew">
        <input name="tobind" type="hidden" id="tobind" value="0">
        <input type="hidden" name="enews" value="register">

        <div class="layui-form-item">
          <label class="layui-form-label">用户名</label>
          <div class="layui-input-block">
            <input type="text" name="username" id="reg_name" lay-verify="title" autocomplete>
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">密码</label>
          <div class="layui-input-block">
            <input type="password" name="password" id="reg_password" lay-verify="required" autocomplete>
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">重复密码</label>
          <div class="layui-input-block">
            <input type="password" name="repassword" id='reg_repassword' lay-verify="required">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">邮箱</label>
          <div class="layui-input-block">
            <input type="text" name="email" id='reg_email' type="text" lay-verify="required"> 
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">验证码</label>
          <div class="layui-input-block">
                <input type="text" class="intxt w200" style="width: 50px; text-transform: uppercase;" id="vdcode_reg" name="vdcode"/><img id="vdimgck_reg" align="absmiddle" onclick="this.src=this.src+'?'" style="cursor: pointer;" alt="看不清？点击更换" src="/include/vdimgck.php"/>
           看不清？ <a href="javascript:void(0)" onclick="changeAuthCode();">点击更换</a>
          </div>
        </div>

        <div class="layui-form-item">
          <div class="layui-input-block">
            <button id="reg_button" class="layui-btn layui-btn1" lay-submit="" lay-filter="demo1">立即注册
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
          </div>
        </div>
</form>
  </div>

<!-- //AJAX评论区 开始 -->

<link href="/comments/comments.css" rel="stylesheet" type="text/css" />
<div id="comments" class="entry-comments">
    <h3 id="reply-title" class="comment-reply-title">发表评论</h3>
    {dede:include file='ajaxcomments.htm' /}
</div>
<script>
    window.jsui = {
        uri: '{dede:global.cfg_basehost/}'
    };
</script>
<script type='text/javascript' src='/comments/loader.js?ver=3.0'></script>

<!-- //AJAX评论区 结束 -->



</div>
<script type="text/javascript">
$(function(){
        
$(".show").hover(function() {
  $(this).children(".shadow").show();
}, function() {
  $(this).children(".shadow").hide();
});

    })
    
    
    layui.use('element', function(){
  var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
  
  //监听导航点击
  element.on('nav(demo)', function(elem){
    //console.log(elem)
    layer.msg(elem.text());
  });
});


  layui.use(['form','upload', 'laydate','laypage', 'layer'], function(){
    var form = layui.form,
    layer = layui.layer,
    laydate = layui.laydate;
  });






//登录弹窗
  function logintc(){
      layer.open({
        type: 1,
        title: '用户登录',
        shadeClose: true,
        shade: 0.8,
        area: ['400px', 'auto'],
        content: $('#logintc') //iframe的url
      });
  }


  //注册弹窗
function design(){
layer.open({
        type: 1,
  title: '用户注册',
  shadeClose: true,
  shade: 0.8,
  area: ['400px', 'auto'],
  content: $('#design') //iframe的url
        
});
}
//cgitool.local/member/login.php?fmdo=login&dopost=login&userid=test&password=123456a&keeptime=86400
$('#login_button').on('click', function(e){
            e.preventDefault();
            var url = '/member/index_do.php';
            var username = $('#login_name').val();
            var password = $('#login_password').val();
            var vdcode = $('#vdcode').val();
            var data = {
                fmdo: "login",
                dopost: "login",
                gourl: "",
                userid: username,
                pwd: password,
                vdcode: vdcode,
                keeptime: 86400
            };
            $.post(url, data, function(data,status){
                //alert(data);
                if(data.indexOf("成功登录") >= 0){
                      //alert('登陆成功,页面跳转中..请稍后');
                      location.reload();
                  }else if(data.indexOf("用户名不存在") >= 0){
                      alert("用户名不存在！");
                  }else if(data.indexOf("验证码错误") >= 0){
                     alert("验证码错误!");
                  }else if(data.indexOf("为空") >= 0){
                      alert("密码不能为空！");
                  }else if(data.indexOf("密码错误") >= 0){
                      alert("密码错误！");
                  }else if(data.indexOf("admin") >= 0){
                      alert("你输入的用户名:admin 不合法！");
                  }else {
                      alert("登录不成功，请确认您的cookie是否已开启!");
                }

            });
    });

//cgitool.local/member/reg_new.php?mtype=个人&step=1&fmdo=user&dopost=regbase&userid=test2&uname=test2&userpwd=1&userpwdok=111&email=111

$('#reg_button').on('click', function(e){
            e.preventDefault();
            var url = '/member/reg_new.php';
            var username = $('#reg_name').val();
            var password = $('#reg_password').val();
            var repassword = $('#reg_repassword').val();
            var email = $('#reg_email').val();
            var vdcode = $('#vdcode_reg').val();
            var data = {
                mtype: "个人",
                step: 1,
                fmdo: "user",
                dopost: "regbase",
                userid: username,
                uname: username,
                userpwd: password,
                userpwdok: repassword,
                email: email,
                vdcode: vdcode,
            };
            $.post(url, data, function(data,status){
                if(data.indexOf("注册成功") >= 0){
                      location.reload();
                  }else if(data.indexOf("用户名已经存在") >= 0){
                      alert("用户名已经存在！");
                  }else if(data.indexOf("验证码错误") >= 0){
                     alert("验证码错误!");
                  }else if(data.indexOf("你的用户名或密码过短，不允许注册") >= 0){
                      alert("你的用户名或密码过短，不允许注册！");
                  }else if(data.indexOf("你两次输入的密码不一致") >= 0){
                      alert("你两次输入的密码不一致");
                  }else if(data.indexOf("Email格式不正确") >= 0){
                      alert("Email格式不正确！");
                  }else {
                      alert("注册失败!");
                }
            });
    });

///member/index_do.php?fmdo=login&dopost=exit
$('#login_out').on('click', function(e){
            e.preventDefault();
            var url = '/member/index_do.php';
            var data = {
                fmdo: "login",
                dopost: "exit",
            };
            $.post(url, data, function(data,status){
                //alert(data);
                if(data.indexOf("成功") >= 0){
                      //alert('登陆成功,页面跳转中..请稍后');
                      location.reload();
                  }
            });
    });

  function changeAuthCode() {
    var num =   new Date().getTime();
    var rand = Math.round(Math.random() * 10000);
    num = num + rand;
    $('#ver_code').css('visibility','visible');
    if ($("#vdimgck_reg")[0]) {
      $("#vdimgck_reg")[0].src = "/include/vdimgck.php?tag=" + num;
    }
    if ($("#vdimgck")[0]) {
      $("#vdimgck")[0].src = "/include/vdimgck.php?tag=" + num;
    }
    return false;
  }

  // $("p a").click(function(){
  //   var zan = $(this);
  //   var id = zan.attr("rel"); //对应id
  //   zan.fadeOut(300); //渐隐效果
  //   $.ajax({
  //     type:"POST",
  //     url:"/zan.php",
  //     data:"id="+id,
  //     cache:false, //不缓存此页面
  //     success:function(data){
  //       zan.html(data);
  //       zan.fadeIn(300); //渐显效果
  //     }
  //   });
  //   return false;
  // });

  $(".up").on('click', function(e){
    e.preventDefault();
    var zan = $(this).find("a");
    var span = $(this).find("span");
    var id = $(this).attr("rel"); //对应id
    zan.fadeOut(300); //渐隐效果
    $.ajax({
      type:"POST",
      url:"/zan.php",
      data:"id="+id,
      cache:false, //不缓存此页面
      success:function(data){
        //alert(data);
        if (data == '赞过了..') {
          zan.html(data);
        } else {
          span.html(data);
        }
        zan.fadeIn(300); //渐显效果
      }
    });
    return false;
  });
 
</script>
</body>
</html>
