<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="renderer" content="webkit">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>CGItool</title>
<link href="{dede:global.cfg_templets_skin/}/css/style.css" type="text/css" rel="stylesheet" />
<script src="{dede:global.cfg_templets_skin/}/js/jquery-1.11.3.min.js" type="text/javascript"></script>
<script type="text/javascript" src="{dede:global.cfg_templets_skin/}/layui/layui.js"></script>
<style type="text/css">
  /*pages*/ .pagination-wrapper{ margin: 20px 0; } .pagination{ height: 34px; text-align: center; } .pagination li { display: inline-block; height: 34px; margin-right: 5px; } .pagination li a{ float: left; display: block; height: 32px; line-height: 32px; padding: 0 12px; font-size: 16px; border: 1px solid #dddddd; color: #555555; text-decoration: none; } .pagination li a:hover{ background:#f5f5f5; color:#0099ff; } .pagination li.thisclass { background: #09f; color: #fff; } .pagination li.thisclass a,.pagination li.thisclass a:hover{ background: transparent; border-color: #09f; color: #fff; cursor: default; }
</style>
</head>

<body>
<div id="container">
<script type="text/javascript" src="{dede:global.cfg_templets_skin/}/js/main.js"></script>

<div class="header clearfix ctnt">
    <div class="logo"><img src="{dede:global.cfg_templets_skin/}/images/logo.png" /></div>

    <ul class="layui-nav">
  <li class="layui-nav-item layui-this"> <a href="/">首页</a> </li>
  {dede:channelartlist typeid='top' row='10' currentstyle="<li class='nactive'><a href='~typelink~' ~rel~><span>~typename~</span></a></li>"}
  <li class="layui-nav-item">
    <!-- <a href="{dede:field name='typeurl'/}" >{dede:field name='typename' /}</a> -->
    <a href="javascript:;" >{dede:field name='typename' /}</a>
    <dl class="layui-nav-child snav">
    <dd>
    {dede:sql sql='select * from dede_arctype where reid =~id~ '}
        <a href="javascript:;" class="btit">[field:typename/]</a>
        <div class="snavfl clearfix">
        [field:id runphp='yes']
                global $dsql;
                $id=@me;
                $sql='Select * from dede_arctype where reid='.$id.' ORDER BY id limit 0,20';
                $dsql->SetQuery($sql);
                $dsql->Execute();
                while($row = $dsql->GetArray()){
                    $url = str_replace("{cmspath}","",$row['typedir']);
                    $str .='<a href="/plus/list.php?tid='.$row[id].'">'.$row['typename'].'</a>';
                    @me = $str;
                }                      
                if(@me == $id){
                  @me ='';
                }
         [/field:id]
         </div>
      {/dede:sql}
    </dd>
    </dl>
  </li>
  {/dede:channelartlist}
  {dede:php}
  require_once(DEDEMEMBER."/config.php");
  if(checkLogin()){
    echo '
    <li class="layui-nav-item layui-nav-item1 usera" lay-unselect=""> <a href="javascript:;"><img src="/templets/cgi/images/noavatar.gif" class="layui-nav-img">'.$uid.'</a><dl class="layui-nav-child"><dd><a href="/">个人中心</a></dd><dd><a id="login_out" href="/member/index_do.php?fmdo=login&dopost=exit">退出</a></dd></dl></li>';
  }
  {/dede:php}
</ul>



{dede:php}
  require_once(DEDEMEMBER."/config.php");
  if(!checkLogin()){
    echo '
    <div class="login"><a href="#" onclick="logintc()">登录</a>|<a href="#" onclick="design()">注册</a></div>';
  }
{/dede:php}


  </div>

<!--登录弹窗-->
  <div class="logina"  id="logintc" style="display:none;">
 <form id="login_form" class="layui-form" method="post" action="/member/login.php">
    <input type="hidden" name="ecmsfrom" value="9">
    <input name="tobind" type="hidden" id="tobind" value="0">
    <input type="hidden" name="enews" value="login">
    <input type="hidden" name="lifetime" value="3600">
  <div class="layui-form-item">
    <label class="layui-form-label">用户名</label>
    <div class="layui-input-block">
      <input type="text" name="username" id="login_name" lay-verify="title" autocomplete>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">密码</label>
    <div class="layui-input-block">
      <input type="password" name="password" id="login_password" lay-verify="required" autocomplete>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">&nbsp;</label>
    <div class="layui-input-block">
      <p><a href="/e/member/GetPassword/">忘记密码？</a></p>
    </div>
  </div>

   <div class="layui-form-item">
    <label class="layui-form-label">验证码</label>
    <div class="layui-input-block">
          <input id="vdcode" class="text login_from3" type="text" style="width: 50px; text-transform: uppercase;" name="vdcode"/>
          <img id="vdimgck" align="absmiddle" onclick="this.src=this.src+'?'" style="cursor: pointer;" alt="看不清？点击更换" src="/include/vdimgck.php"/>
           看不清？ <a href="#" onclick="changeAuthCode();">点击更换</a>
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-input-block">
      <button id="login_button" class="layui-btn layui-btn1" lay-submit="" lay-filter="demo1">立即登录
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>
</form>
  </div>

  <!--注册弹窗-->
  <div class="logina"  id="design" style="display:none;">
     <form class="layui-form" method="post" name="userinfoform" action="/member/index_do.php?fmdo=user&dopost=regnew">
        <input name="tobind" type="hidden" id="tobind" value="0">
        <input type="hidden" name="enews" value="register">

        <div class="layui-form-item">
          <label class="layui-form-label">用户名</label>
          <div class="layui-input-block">
            <input type="text" name="username" id="reg_name" lay-verify="title" autocomplete>
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">密码</label>
          <div class="layui-input-block">
            <input type="password" name="password" id="reg_password" lay-verify="required" autocomplete>
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">重复密码</label>
          <div class="layui-input-block">
            <input type="password" name="repassword" id='reg_repassword' lay-verify="required">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">邮箱</label>
          <div class="layui-input-block">
            <input type="text" name="email" id='reg_email' type="text" lay-verify="required"> 
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">验证码</label>
          <div class="layui-input-block">
                <input type="text" class="intxt w200" style="width: 50px; text-transform: uppercase;" id="vdcode_reg" name="vdcode"/><img id="vdimgck_reg" align="absmiddle" onclick="this.src=this.src+'?'" style="cursor: pointer;" alt="看不清？点击更换" src="/include/vdimgck.php"/>
           看不清？ <a href="javascript:void(0)" onclick="changeAuthCode();">点击更换</a>
          </div>
        </div>

        <div class="layui-form-item">
          <div class="layui-input-block">
            <button id="reg_button" class="layui-btn layui-btn1" lay-submit="" lay-filter="demo1">立即注册
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
          </div>
        </div>
</form>
  </div>

  <div class="list">
    <div class="choose clearfix">
       <!-- <span class="this"><a href="/e/public/ViewClick/?classid=[!--classid--]&id=[!--id--]&down=5">全部</a></span> -->
       <span class="this"><a href="/e/action/ListInfo.php?classid=9&orderby=onclick&all=1">全部</a></span>
       <span   ><a href="/e/action/ListInfo.php?classid=9&orderby=newstime">最新</a></span>
       <span  ><a href="/e/action/ListInfo.php?classid=9&orderby=diggtop">人气</a></span>
       <span  ><a href="/e/action/ListInfo.php?classid=9&orderby=onclick">点击</a></span>
       <span  ><a href="/e/action/ListInfo.php?classid=9&orderby=plnum">回复</a></span>
    </div>
    <div class="cginew">
    <div class="layui-row">
      {dede:list pagesize="50"}
             <div class="border">
              <div class="grid-demo"> <a href="[field:arcurl/]" class="show"> <img src="[field:picname/]" />
                <div class="shadow" style="display:none;"> [field:title/] </div>
                </a>
                <div class="cgiarc">
                  <h3><a href=" /ruanjianchajian/ruanjianyi/ruanjian1/2019-05-15/88.html ">[field:title/]</a></h3>
                  <div class="tag"><strong><a href="#" target="_blank">超写实</a> <a href="#" target="_blank">模型</a> <a href="#" target="_blank">预售</a> <a href="#" target="_blank">场景</a> </li></strong></div>
                  <div class="action"> <span><i class="fa fa-eye" aria-hidden="true"></i>[field:click /]</span><span><i class="fa fa-commenting-o" aria-hidden="true"></i> [field:id function='cnum(@me)'/]</span><span class="handok"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i>[field:goodpost /]</span></div>
                </div>
              </div>
        </div>
      {/dede:list}
    </div>
  </div>
  <div class="pagination-wrapper"> <div class="pagination">{dede:pagelist listsize='5' listitem='info,index,end,pre,next,pageno'/}</div> </div>

</div>
</div>
</div>
<!-- 页脚 -->
<div class="footer">
Copyright ©2019 CGITool right reserved.京ICP备11081390号-1
</div>
<script type="text/javascript">

$(function(){
        
$(".show").hover(function() {
  $(this).children(".shadow").show();
}, function() {
  $(this).children(".shadow").hide();
});

    })
    
    
    layui.use('element', function(){
  var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
  
  //监听导航点击
  element.on('nav(demo)', function(elem){
    //console.log(elem)
    layer.msg(elem.text());
  });
});


  layui.use(['form','upload', 'laydate','laypage', 'layer'], function(){
    var form = layui.form,
    layer = layui.layer,
    laydate = layui.laydate;
  });






//登录弹窗
  function logintc(){
      layer.open({
        type: 1,
        title: '用户登录',
        shadeClose: true,
        shade: 0.8,
        area: ['400px', 'auto'],
        content: $('#logintc') //iframe的url
      });
  }


  //注册弹窗
function design(){
layer.open({
        type: 1,
  title: '用户注册',
  shadeClose: true,
  shade: 0.8,
  area: ['400px', 'auto'],
  content: $('#design') //iframe的url
        
});
}
//cgitool.local/member/login.php?fmdo=login&dopost=login&userid=test&password=123456a&keeptime=86400
$('#login_button').on('click', function(e){
            e.preventDefault();
            var url = '/member/index_do.php';
            var username = $('#login_name').val();
            var password = $('#login_password').val();
            var vdcode = $('#vdcode').val();
            var data = {
                fmdo: "login",
                dopost: "login",
                gourl: "",
                userid: username,
                pwd: password,
                vdcode: vdcode,
                keeptime: 86400
            };
            $.post(url, data, function(data,status){
                //alert(data);
                if(data.indexOf("成功登录") >= 0){
                      //alert('登陆成功,页面跳转中..请稍后');
                      location.reload();
                  }else if(data.indexOf("用户名不存在") >= 0){
                      alert("用户名不存在！");
                  }else if(data.indexOf("验证码错误") >= 0){
                     alert("验证码错误!");
                  }else if(data.indexOf("为空") >= 0){
                      alert("密码不能为空！");
                  }else if(data.indexOf("密码错误") >= 0){
                      alert("密码错误！");
                  }else if(data.indexOf("admin") >= 0){
                      alert("你输入的用户名:admin 不合法！");
                  }else {
                      alert("登录不成功，请确认您的cookie是否已开启!");
                }

            });
    });

//cgitool.local/member/reg_new.php?mtype=个人&step=1&fmdo=user&dopost=regbase&userid=test2&uname=test2&userpwd=1&userpwdok=111&email=111

$('#reg_button').on('click', function(e){
            e.preventDefault();
            var url = '/member/reg_new.php';
            var username = $('#reg_name').val();
            var password = $('#reg_password').val();
            var repassword = $('#reg_repassword').val();
            var email = $('#reg_email').val();
            var vdcode = $('#vdcode_reg').val();
            var data = {
                mtype: "个人",
                step: 1,
                fmdo: "user",
                dopost: "regbase",
                userid: username,
                uname: username,
                userpwd: password,
                userpwdok: repassword,
                email: email,
                vdcode: vdcode,
            };
            $.post(url, data, function(data,status){
                if(data.indexOf("注册成功") >= 0){
                      location.reload();
                  }else if(data.indexOf("用户名已经存在") >= 0){
                      alert("用户名已经存在！");
                  }else if(data.indexOf("验证码错误") >= 0){
                     alert("验证码错误!");
                  }else if(data.indexOf("你的用户名或密码过短，不允许注册") >= 0){
                      alert("你的用户名或密码过短，不允许注册！");
                  }else if(data.indexOf("你两次输入的密码不一致") >= 0){
                      alert("你两次输入的密码不一致");
                  }else if(data.indexOf("Email格式不正确") >= 0){
                      alert("Email格式不正确！");
                  }else {
                      alert("注册失败!");
                }
            });
    });

///member/index_do.php?fmdo=login&dopost=exit
$('#login_out').on('click', function(e){
            e.preventDefault();
            var url = '/member/index_do.php';
            var data = {
                fmdo: "login",
                dopost: "exit",
            };
            $.post(url, data, function(data,status){
                //alert(data);
                if(data.indexOf("成功") >= 0){
                      //alert('登陆成功,页面跳转中..请稍后');
                      location.reload();
                  }
            });
    });

  function changeAuthCode() {
    var num =   new Date().getTime();
    var rand = Math.round(Math.random() * 10000);
    num = num + rand;
    $('#ver_code').css('visibility','visible');
    if ($("#vdimgck_reg")[0]) {
      $("#vdimgck_reg")[0].src = "/include/vdimgck.php?tag=" + num;
    }
    if ($("#vdimgck")[0]) {
      $("#vdimgck")[0].src = "/include/vdimgck.php?tag=" + num;
    }
    return false;
  }



</script>
</body>
</html>
